# 层叠样式表管理器 - 开发日志

## 1 元素批处理

* [ ] 构建一个`ScriptAssembler`原型对象，通过传入的参数组装出一段脚本。
* [ ] 构建一个`BrowserInjector`原型对象，通过传入浏览器对象以及组装好的脚本来形成。
* [ ] 注入jQuery后，获取所有元素，以及他们的属性、值等等信息，在UI界面作为input标签输入提示的功能；
* [ ] 在元素空间页面实现元素批处理选取向导，自动计算该元素的同类，再由人工调整。
* [ ] 增加储存脚本的功能，让用户能直接对特定文档选择样式处理脚本。值得注意的是，只有在打开文档后才能进行多文档批处理。

## 2 样式表管理器

### 2.1 获取页面外联、嵌入式样式表

### 2.2 CSS的格式化与压缩

* [ ] 使用 `js-beautify` 库，并在 `CodeMirror` 里面显示
* [ ] 创建一个Widget：默认元素是一个 `<div>` 元素，拥有 `contenteditable="true"` 的属性，对其进行组件化，绑定CSS格式化和压缩的功能。

### 2.3 代码高亮

* [ ] 代码高亮采用 Google Code Prettify 库，还有一个 Prettier 库

## 3 动态排版

### 3.1 交互功能

利用jQueryUI的核心——互动功能 `Interactions` 、 `Effects` 、 `Utilities` 三个功能，赋予页面所有元素可移动、可排序的功能。

* [ ] 在弹出窗口中实现新建 `Wrapper` 的功能，自动将 `body` 下所有元素 `append` 到自己后面，让用户能控制整个文档区域的大小。

### 3.2 脚本注入

首先注入 `jQuery` ，然后注入 `jQuery UI` ，最后再注入自定义脚本用以载入 `CSS` 以及元素控件。

* [x] 注入 `jQuery`
* [x] 注入 `jQuery UI`
* [x] 注入自定义脚本用以载入 `CSS` 以及元素控件脚本

### 3.3 元素选取

#### 方案一

利用 `jQuery` 的鼠标事件句柄，给被鼠标悬停的元素添加荧光边框，在鼠标点击后激活元素控件。

* [x] ~~利用 `Outline` 样式来实现荧光边框；注意要找到浏览器默认样式。~~
* [x] ~~插入CSS样式表， `:hover,:focus {outline: 1px solid #26C2A7}`；~~
* [x] ~~点击后直接在该元素内联样式添加 `$(this).css('outline', '1px solid #26C2A7')`；~~
* [x] ~~另外一种实现方法：注意应该先进行一场判断，如果父元素左右边框没有大于2px的padding的话，就进行设置，如果有就不设置。~~

#### 方案二

~~元素选中状态可以通过新建一个边框元素来强调~~，~~不使用受边距限制的Shadow~~，参考jQueryUI

* [x] ~~Shadow 还有一个限制之处在于：改变padding会影响页面布局。~~
* [x] ~~这种方案在浏览器页面滑动后会发生改变，注意要监控元素位置变化。用 `_trigger()` 监控元素位置变动事件。~~
* [x] ~~可以考虑 `scroll()` 事件，当触发时使元素失去焦点。~~
* [x] ~~另外直接使用 `focus()` ，当 `hover()` 时就使该元素获得焦点！这样直接可以利用浏览器默认Outline.~~

#### 方案三

利用元素的 `tabIndex` 属性来模拟元素选取，但这有个缺陷是：点击工具栏时会使元素失去焦点。

* [ ] 利用 `-px` 的 `shadow` 来展示hover效果！
* [ ] 用 `class` 代替 `this.element.css()` 因为后者在 `_destroy` 时会报错。

### 3.4 收尾与退出

* [x] 在修改完毕，激活痕迹清理程序，清除一系列临时的HTML片段。

### 3.5 控件的构建

* [ ] 元素控件 `ElementControl`
    1. [ ] 第一种事项方法时用 `jQueryUI` 的 `Widget Factory` 创建一个小工具。这样小工具具有明显的生命周期。
    2. [x] ~~第二种是创建一个 `ElementControl` 对象，在每次点击元素时，将 `this` 作用域绑定到该元素对象，然后初始化启动。可参考 `Pell` 项目~~。

* [ ] 元素控制面板
    1. [x] 工具栏应该跟随元素的移动二移动
    2. [ ] `Draggable`: Snap to element or grid 对齐功能
    3. [ ] 实现元素包含关系间的`Droppable`： `dragable`的`revert position`
    4. [ ] 实现段落之间的`Sortable`: `Draggable` + `Sortable`
    5. [ ] 模拟Onenote的容器功能
    6. [ ] `Draggabele` 实现横向移动和纵向移动以及自由移动三种模式。
    7. [ ] 展示内联样式及修改能力
    8. [ ] 由于有一些 `wrapper` 看不见，所以增加子元素脱离父元素的功能。